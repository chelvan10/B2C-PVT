# ============================================================================
# ğŸ† MITRE 10 B2C E-COMMERCE TEST AUTOMATION FRAMEWORK
# World-Class Gold Standard Testing Suite - Comprehensive Command Reference
# ============================================================================
# 
# ğŸ“‹ ARCHITECTURE OVERVIEW:
# â”œâ”€â”€ tests/
# â”‚   â”œâ”€â”€ smoke/           # Critical path validation (homepage, core features)
# â”‚   â”œâ”€â”€ e2e/            # End-to-end user journeys (search, checkout, etc.)
# â”‚   â”œâ”€â”€ api/            # Backend API validation & performance testing
# â”‚   â””â”€â”€ utils/          # Shared utilities and test helpers
# â”œâ”€â”€ playwright.config.ts # Multi-project configuration (browsers, devices)
# â”œâ”€â”€ global-setup.ts     # Authentication & state management
# â””â”€â”€ storage/            # Session state & authentication tokens
#
# ğŸ¯ TEST COVERAGE:
# - Smoke Tests: Homepage validation, core functionality
# - E2E Tests: Product search, user journeys, comprehensive flows
# - API Tests: Backend validation, performance, security
# - Cross-Browser: Chrome, Firefox, Edge compatibility
# - Mobile Testing: Android (Pixel 5), iPhone 12 emulation
# - Performance: Response times, concurrent load testing
# - Security: Headers validation, rate limiting, error handling
#
# ğŸ› ï¸ TECHNOLOGY STACK:
# - Framework: Playwright v1.55.0 + TypeScript
# - Reporting: HTML, Allure, JUnit, JSON
# - CI/CD: GitHub Actions ready
# - Authentication: Secure session management
# - Parallel Execution: Configurable workers
# ============================================================================

.PHONY: help install setup test clean report

# Default target
help: ## ğŸ“š Display this comprehensive help menu
	@echo "ğŸ† MITRE 10 B2C E-COMMERCE TEST AUTOMATION FRAMEWORK"
	@echo "============================================================================"
	@echo "ğŸ“‹ QUICK START COMMANDS:"
	@echo ""
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  \033[36m%-25s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""
	@echo "ğŸ¯ EXECUTION EXAMPLES:"
	@echo "  make test-smoke          # Run critical path tests"
	@echo "  make test-mobile         # Test on Android + iPhone"
	@echo "  make test-all-browsers   # Cross-browser validation"
	@echo "  make report-allure       # Generate beautiful reports"
	@echo ""

# ============================================================================
# ğŸš€ SETUP & INSTALLATION
# ============================================================================

install: ## ğŸ“¦ Install all dependencies and setup project
	@echo "ğŸ“¦ Installing Playwright and dependencies..."
	npm install
	npx playwright install
	@echo "âš ï¸  Note: Browser dependencies may require sudo. Run 'sudo npx playwright install-deps' if needed."
	@echo "âœ… Installation complete!"

setup: install ## ğŸ”§ Complete project setup with environment configuration
	@echo "ğŸ”§ Setting up project environment..."
	@mkdir -p storage test-results allure-results playwright-report
	@touch .env
	@echo "MITRE10_BASE_URL=https://www.mitre10.co.nz/" >> .env
	@echo "âœ… Project setup complete!"

verify-setup: ## âœ… Verify installation and configuration
	@echo "ğŸ” Verifying setup..."
	npx playwright --version
	node --version
	npm --version
	@echo "âœ… Setup verification complete!"

# ============================================================================
# ğŸ§ª CORE TEST EXECUTION COMMANDS
# ============================================================================

test: ## ğŸš€ Run all tests with default configuration
	npm run test

test-headed: ## ğŸ‘€ Run tests in headed mode (visible browser)
	npm run test:headed

test-debug: ## ğŸ› Run tests in debug mode with inspector
	npx playwright test --debug

# ============================================================================
# ğŸ“Š TEST SUITE CATEGORIES
# ============================================================================

test-smoke: ## ğŸ’¨ Run smoke tests (critical path validation)
	npm run test:smoke
	@echo "âœ… Smoke tests completed!"

test-smoke-comprehensive: ## ğŸ”¥ Run comprehensive smoke test suite
	npm run test:smoke:comprehensive
	@echo "âœ… Comprehensive smoke tests completed!"

test-e2e: ## ğŸ›£ï¸ Run end-to-end user journey tests
	npm run test:e2e
	@echo "âœ… E2E tests completed!"

test-e2e-comprehensive: ## ğŸ¯ Run comprehensive E2E test suite
	npm run test:e2e:comprehensive
	@echo "âœ… Comprehensive E2E tests completed!"

test-api: ## ğŸ”Œ Run API validation and performance tests
	npm run test:api
	@echo "âœ… API tests completed!"

# ============================================================================
# ğŸ“± DEVICE & BROWSER TESTING
# ============================================================================

test-mobile: ## ğŸ“± Run tests on mobile devices (Android + iPhone)
	npm run test:mobile
	@echo "âœ… Mobile tests completed!"

test-android: ## ğŸ¤– Run tests on Android (Pixel 5 emulation)
	npm run test:android
	@echo "âœ… Android tests completed!"

test-iphone: ## ğŸ“± Run tests on iPhone (iPhone 12 emulation)
	npm run test:iphone
	@echo "âœ… iPhone tests completed!"

test-browsers: ## ğŸŒ Run cross-browser tests (Chrome, Firefox, Edge)
	npm run test:browsers
	@echo "âœ… Cross-browser tests completed!"

test-all-devices: ## ğŸ¯ Run tests on ALL devices and browsers
	npm run test:all-devices
	@echo "âœ… All device tests completed!"

# ============================================================================
# ğŸ¯ SPECIALIZED TEST CATEGORIES
# ============================================================================

test-comprehensive: ## ğŸ† Run comprehensive test suite (smoke + e2e + api)
	npm run test:comprehensive
	@echo "âœ… Comprehensive test suite completed!"

test-positive: ## âœ… Run positive test cases only
	npm run test:positive
	@echo "âœ… Positive test cases completed!"

test-negative: ## âŒ Run negative test cases and error handling
	npm run test:negative
	@echo "âœ… Negative test cases completed!"

test-edge: ## âš¡ Run edge case scenarios
	npm run test:edge
	@echo "âœ… Edge case tests completed!"

test-performance: ## ğŸš€ Run performance and load tests
	npm run test:performance
	@echo "âœ… Performance tests completed!"

test-accessibility: ## â™¿ Run accessibility compliance tests
	npm run test:accessibility
	@echo "âœ… Accessibility tests completed!"

# ============================================================================
# ğŸ¯ ADVANCED EXECUTION OPTIONS
# ============================================================================

test-parallel: ## âš¡ Run tests with maximum parallelization
	npx playwright test --workers=4
	@echo "âœ… Parallel execution completed!"

test-serial: ## ğŸ”„ Run tests sequentially (no parallelization)
	npx playwright test --workers=1
	@echo "âœ… Serial execution completed!"

test-retry: ## ğŸ”„ Run tests with retry on failure
	npx playwright test --retries=3
	@echo "âœ… Tests with retry completed!"

test-specific: ## ğŸ¯ Run specific test file (usage: make test-specific FILE=path/to/test.spec.ts)
	npx playwright test $(FILE)

test-grep: ## ğŸ” Run tests matching pattern (usage: make test-grep PATTERN="search")
	npx playwright test --grep="$(PATTERN)"

# ============================================================================
# ğŸ“Š REPORTING & ANALYSIS
# ============================================================================

report: ## ğŸ“Š Open HTML test report
	npm run report

report-allure: ## ğŸ¨ Generate and open beautiful Allure report
	npm run report:allure
	@echo "âœ… Allure report generated!"

report-serve: ## ğŸŒ Serve Allure report on local server
	npm run report:serve

report-json: ## ğŸ“„ Generate JSON test results
	npx playwright test --reporter=json --output=test-results/results.json

report-junit: ## ğŸ“‹ Generate JUnit XML report
	npx playwright test --reporter=junit --output=test-results/junit.xml

# ============================================================================
# ğŸ”§ MAINTENANCE & UTILITIES
# ============================================================================

clean: ## ğŸ§¹ Clean all test artifacts and reports
	@echo "ğŸ§¹ Cleaning test artifacts..."
	rm -rf test-results/* playwright-report/* allure-results/*
	@echo "âœ… Cleanup completed!"

clean-all: clean ## ğŸ—‘ï¸ Deep clean including node_modules
	@echo "ğŸ—‘ï¸ Deep cleaning project..."
	rm -rf node_modules package-lock.json
	@echo "âœ… Deep cleanup completed!"

update: ## ğŸ”„ Update Playwright and dependencies
	@echo "ğŸ”„ Updating dependencies..."
	npm update
	npx playwright install
	@echo "âœ… Update completed!"

lint: ## ğŸ” Run TypeScript linting
	npx tsc --noEmit
	@echo "âœ… Linting completed!"

# ============================================================================
# ğŸ¯ CI/CD & AUTOMATION COMMANDS
# ============================================================================

ci-test: ## ğŸ¤– Run tests in CI mode (optimized for automation)
	CI=true npx playwright test --reporter=list,html,junit
	@echo "âœ… CI tests completed!"

ci-install: ## ğŸ“¦ CI-optimized installation
	npm ci
	npx playwright install --with-deps
	@echo "âœ… CI installation completed!"

docker-test: ## ğŸ³ Run tests in Docker container
	docker run --rm -v $(PWD):/workspace -w /workspace mcr.microsoft.com/playwright:v1.55.0-focal npm test

# ============================================================================
# ğŸ“ˆ MONITORING & HEALTH CHECKS
# ============================================================================

health-check: ## ğŸ¥ Run basic health check tests
	npx playwright test tests/smoke/homepage.spec.ts --reporter=list
	@echo "âœ… Health check completed!"

smoke-check: test-smoke ## ğŸ’¨ Alias for smoke tests (health monitoring)

performance-check: ## âš¡ Quick performance validation
	npx playwright test --grep="Performance" --reporter=list
	@echo "âœ… Performance check completed!"

# ============================================================================
# ğŸ”§ DEVELOPMENT & DEBUGGING
# ============================================================================

debug-test: ## ğŸ› Debug specific test with inspector
	npx playwright test --debug $(FILE)

trace-viewer: ## ğŸ‘ï¸ Open Playwright trace viewer
	npx playwright show-trace test-results/*/trace.zip

codegen: ## ğŸ¬ Generate test code using Playwright codegen
	npx playwright codegen https://www.mitre10.co.nz/

# ============================================================================
# ğŸ“‹ COMPREHENSIVE COMMAND REFERENCE
# ============================================================================

commands-list: ## ğŸ“‹ Display all available npm scripts
	@echo "ğŸ“‹ AVAILABLE NPM SCRIPTS:"
	@echo "=========================="
	@npm run | grep -E "^  [a-z]" | sort

project-info: ## â„¹ï¸ Display project information and statistics
	@echo "â„¹ï¸ PROJECT INFORMATION:"
	@echo "======================="
	@echo "ğŸ“ Project: Mitre 10 B2C E-Commerce Test Suite"
	@echo "ğŸ› ï¸ Framework: Playwright $(shell npx playwright --version | cut -d' ' -f2)"
	@echo "ğŸ“Š Test Files: $(shell find tests -name "*.spec.ts" | wc -l)"
	@echo "ğŸ¯ Test Projects: $(shell grep -c "name:" playwright.config.ts)"
	@echo "ğŸ“± Mobile Devices: Android (Pixel 5), iPhone 12"
	@echo "ğŸŒ Browsers: Chrome, Firefox, Edge"
	@echo "ğŸ“Š Reporters: HTML, Allure, JUnit, JSON"
	@echo ""

# ============================================================================
# ğŸ¯ EXAMPLE USAGE SCENARIOS
# ============================================================================

demo-quick: ## ğŸš€ Quick demo run (smoke tests + report)
	@echo "ğŸš€ Running quick demo..."
	make test-smoke
	make report
	@echo "âœ… Quick demo completed!"

demo-comprehensive: ## ğŸ† Comprehensive demo (all tests + reports)
	@echo "ğŸ† Running comprehensive demo..."
	make test-comprehensive
	make report-allure
	@echo "âœ… Comprehensive demo completed!"

demo-mobile: ## ğŸ“± Mobile testing demo
	@echo "ğŸ“± Running mobile demo..."
	make test-mobile
	make report
	@echo "âœ… Mobile demo completed!"

# ============================================================================
# ğŸ“š DOCUMENTATION & HELP
# ============================================================================

docs: ## ğŸ“š Display comprehensive documentation
	@echo "ğŸ“š MITRE 10 B2C TEST AUTOMATION FRAMEWORK"
	@echo "=========================================="
	@echo ""
	@echo "ğŸ—ï¸ ARCHITECTURE:"
	@echo "  - Multi-project Playwright configuration"
	@echo "  - Cross-browser and mobile device testing"
	@echo "  - Comprehensive reporting with Allure"
	@echo "  - CI/CD ready with GitHub Actions"
	@echo ""
	@echo "ğŸ¯ TEST CATEGORIES:"
	@echo "  - Smoke Tests: Critical path validation"
	@echo "  - E2E Tests: Complete user journeys"
	@echo "  - API Tests: Backend validation & performance"
	@echo "  - Mobile Tests: Android & iPhone emulation"
	@echo "  - Cross-Browser: Chrome, Firefox, Edge"
	@echo ""
	@echo "ğŸ“Š REPORTING:"
	@echo "  - HTML Reports: Interactive test results"
	@echo "  - Allure Reports: Beautiful, detailed analysis"
	@echo "  - JUnit XML: CI/CD integration"
	@echo "  - JSON Output: Programmatic access"
	@echo ""
	@echo "ğŸš€ QUICK START:"
	@echo "  1. make install     # Setup project"
	@echo "  2. make test-smoke  # Run critical tests"
	@echo "  3. make report      # View results"
	@echo ""

# ============================================================================
# ğŸ¯ ADVANCED SCENARIOS
# ============================================================================

stress-test: ## ğŸ’ª Run stress tests with high load
	@echo "ğŸ’ª Running stress tests..."
	npx playwright test --workers=8 --retries=0 --repeat-each=3
	@echo "âœ… Stress tests completed!"

regression-suite: ## ğŸ”„ Full regression test suite
	@echo "ğŸ”„ Running regression suite..."
	make clean
	make test-comprehensive
	make test-all-devices
	make report-allure
	@echo "âœ… Regression suite completed!"

nightly-build: ## ğŸŒ™ Nightly build test execution
	@echo "ğŸŒ™ Running nightly build tests..."
	make ci-test
	make report-allure
	@echo "âœ… Nightly build completed!"

# ============================================================================
# ğŸ“Š METRICS & ANALYTICS
# ============================================================================

test-metrics: ## ğŸ“Š Display test execution metrics
	@echo "ğŸ“Š TEST EXECUTION METRICS:"
	@echo "=========================="
	@echo "ğŸ“ Total Test Files: $(shell find tests -name "*.spec.ts" | wc -l)"
	@echo "ğŸ§ª Smoke Tests: $(shell find tests/smoke -name "*.spec.ts" | wc -l)"
	@echo "ğŸ›£ï¸ E2E Tests: $(shell find tests/e2e -name "*.spec.ts" | wc -l)"
	@echo "ğŸ”Œ API Tests: $(shell find tests/api -name "*.spec.ts" | wc -l)"
	@echo "ğŸ“± Mobile Projects: 2 (Android, iPhone)"
	@echo "ğŸŒ Browser Projects: 3 (Chrome, Firefox, Edge)"
	@echo ""

coverage-report: ## ğŸ“ˆ Generate test coverage analysis
	@echo "ğŸ“ˆ Generating coverage report..."
	npx playwright test --reporter=html
	@echo "âœ… Coverage report generated!"

# ============================================================================
# ğŸ” SECURITY & COMPLIANCE
# ============================================================================

security-scan: ## ğŸ” Run security-focused tests
	npx playwright test --grep="security|Security" --reporter=list
	@echo "âœ… Security scan completed!"

compliance-check: ## âœ… Run compliance and accessibility tests
	npx playwright test --grep="accessibility|Accessibility" --reporter=list
	@echo "âœ… Compliance check completed!"

# ============================================================================
# ğŸ¯ FINAL SUMMARY
# ============================================================================

summary: ## ğŸ“‹ Display complete framework summary
	@echo "ğŸ† MITRE 10 B2C E-COMMERCE TEST AUTOMATION FRAMEWORK SUMMARY"
	@echo "=============================================================="
	@echo ""
	@echo "ğŸ¯ FRAMEWORK CAPABILITIES:"
	@echo "  âœ… Multi-browser testing (Chrome, Firefox, Edge)"
	@echo "  âœ… Mobile device emulation (Android, iPhone)"
	@echo "  âœ… API testing and validation"
	@echo "  âœ… Performance and load testing"
	@echo "  âœ… Security and compliance testing"
	@echo "  âœ… Comprehensive reporting (HTML, Allure, JUnit)"
	@echo "  âœ… CI/CD integration ready"
	@echo "  âœ… Parallel execution support"
	@echo "  âœ… Debug and trace capabilities"
	@echo ""
	@echo "ğŸš€ QUICK COMMANDS:"
	@echo "  make install          # Setup everything"
	@echo "  make test-smoke       # Critical path tests"
	@echo "  make test-mobile      # Mobile testing"
	@echo "  make test-all-devices # Complete device matrix"
	@echo "  make report-allure    # Beautiful reports"
	@echo ""
	@echo "ğŸ“š For detailed help: make help"
	@echo "ğŸ“Š For metrics: make test-metrics"
	@echo "ğŸ”§ For project info: make project-info"
	@echo ""
	@echo "ğŸ† World-Class Gold Standard Testing Framework Ready!"
	@echo "=============================================================="